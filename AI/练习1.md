### 一、单选题

1. 在对 RAG 系统进行自动化评测时，以下哪项是衡量模型生成答案与参考答案一致性的核心指标？
   A. 检索召回率    RAG系统是否检索到了正确且相关的文档片段,即是否有重要内容遗漏，它衡量的是检索的完整性
   **B.** 答案相关性（Relevance）生成的答案是否准确地回答了用户的问题
   C. 上下文精确匹配（Context Precision） 衡量检索段落的精确性，排名是否在顶层
   D. 响应时间  性能指标
2. 某企业的答疑机器人常出现 “幻觉回答”（生成未在知识库中提及的内容），应重点优化哪个 RAG 评测指标？
   A. 上下文召回率（Context Recall）
   **B**. 答案忠实度（Faithfulness） *用于评估生成答案是否完全基于检索到的上下文，偏低时会导致 “幻觉”，需重点优化。*
   C. 检索速度
   D. 用户满意度
3. 使用 RAGAS 工具进行评测时，若需评估 “检索到的段落是否与问题真正相关”，需关注的指标是：
   **A.** Context Relevance
   B. Answer Correctness   评估 RAG 应用整体回答质量,越符合事实的answer得分越高, 由 answer 和 ground_truth 的**语义相似度**和**事实准确度**计算得出
   C. Context Coverage
   D. Answer Fluency
4. 以下哪种情况最可能导致 RAG 系统的 “上下文召回率（Context Recall）” 偏低？
   A. 生成的答案语言不流畅
   B. 检索到的段落未包含回答问题所需的关键信息:  上下文召回率低表示未检索到回答问题所需的关键信息
   C. 模型生成答案时过度依赖外部知识
   D. 文本切片粒度太小

### 二、多选题

1. 自动化评测相比人工评测的优势包括：（多选）
   **A**. 可重复性高，结果更稳定
   **B**. 能覆盖大规模测试集
   **C.** 可实时反馈优化效果
   D. 能完全替代人工对复杂场景的判断
2. 以下属于 RAG 系统核心评测维度的有：（多选）
   **A.** 检索阶段的召回率与精确率
   **B**. 生成答案的忠实度与相关性
   C. 模型训练时的损失函数值
   **D**. 系统的响应延迟与并发处理能力  系统性能
3. 为提升答疑机器人的自动化评测效果，可采取的措施有：（多选）
   **A**. 构建包含多样化问题的测试集
   **B**. 为每个测试问题标注标准答案和相关参考段落
   **C**. 结合 RAGAS 与人工抽样复核
   D. 仅使用单一指标（如准确率）评估整体性能     需结合多维度指标

### 三、判断题

1. RAG 系统的 “上下文精确匹配（Context Precision）” 越高，说明检索到的无关段落越少。（T ）

2. 自动化评测工具（如 RAGAS）可直接输出 “是否需要优化 RAG 系统” 的结论，无需人工分析。（F ）

3. 文本切片策略会影响检索召回率，过粗的切片可能导致关键信息被遗漏。（T ）

   **过粗的切片**可能导致**关键信息被包含在无关内容**中，降低召回率；**过细则可能割裂语义**。

### 四、简答题

1. 简述在自动化评测中，“答案忠实度（Faithfulness）” 与 “上下文相关性（Context Relevance）” 的区别。

   Context Recall :   关注检索到的上下文   是否 包含了    真实答案中的所有关键信息

   忠实度（Faithfulness）：评估生成答案是否严格基于检索到的上下文，是否存在 “幻觉”（无中生有）。

   Context Precision :  评估  检索到的上下文中相关内容的排名情况，即检索结果的准确性和相关性，它衡量的是检索结果中相关信息的集中度和排序质量

2. 某答疑机器人在测试中，检索到的段落均包含问题的关键信息，但生成的答案却与段落内容矛盾。请分析可能的原因，并提出至少 2 种优化方案。

   - 可能原因：**提示词**设计不合理（**未明确要求基于上下文生成**）、**模型**对上下文的理解偏差、**检索段落**存在歧义。
   - 优化方案：
     ① 优化提示词，明确指令 “**仅基于提供的上下文回答，不添加外部信息**”；
     ② 对**检索到的段落进行重排序**，优先使用相关性更高的内容；
     ③ 采用**更精细的文本切片策略**，减少歧义段落的影响。



在 Ragas 中，Context Recall（上下文召回率）和 Context Precision（上下文精度）是用于评估 RAG 系统检索性能的两个重要指标。以下是它们的定义与区别：

- **Context Recall（上下文召回率）**：衡量检索到的上下文与人类提供的真实答案的一致程度。它通过分析真实答案中的每个句子，确定其是否可以归因于检索到的上下文来计算，取值范围在 0 到 1 之间，值越高表示性能越好。例如，假设真实答案中包含 10 个关键句子，而检索到的上下文中能找到 8 个关键句子与之对应，那么上下文召回率就是 8÷10=0.8。
- **Context Precision（上下文精度）**：评估所有在上下文中呈现的与基本事实相关的条目是否排名较高。理想情况下，所有相关文档块都应出现在顶层。该指标使用问题和上下文来计算，值范围在 0 到 1 之间，分数越高表示精度越高。例如，检索到了 10 个上下文文档块，其中有 6 个是与问题真正相关的，并且这 6 个相关的文档块都排在了前 8 位，那么上下文精度就是一个相对较高的值，具体计算可参考其复杂的计算公式，但简单理解就是相关内容排名越靠前，精度越高。

两者的区别在于：Context Recall 主要关注检索到的上下文是否包含了真实答案中的所有关键信息，即是否有重要内容遗漏，它衡量的是检索的完整性；而 Context Precision 更侧重于评估检索到的上下文中相关内容的排名情况，即检索结果的准确性和相关性，它衡量的是检索结果中相关信息的集中度和排序质量





2_5_优化 RAG 应用提升问答准确度准确度

### 一、单选题（8 题）

1. 某企业 RAG 系统在检索时经常能找到与问题相关的文档段落，但返回的段落包含大量无关信息，导致生成答案冗余。最可能需要优化的环节是：
   A. 增大文本切片的粒度     会降低精确率
   B. 提升上下文召回率（Context Recall） 检索全面性指标
   **C.** 优化检索的精确率（Precision）
   D. 增加文档的存储数量
2. 在 RAG 系统中，采用 "句子窗口检索 + 自动合并相关段落" 的策略主要是为了：
   A. 减少模型的计算量，提升响应速度
   **B**. 确保检索到的上下文包含完整的语义信息
   C. 降低对基础模型推理能力的依赖
   D. 增加检索结果的数量
3. 某电商 RAG 系统在回答 "如何申请退换货" 时，总是遗漏 "需保留原包装" 这一关键条件。经排查发现知识库中存在该信息，但未被检索到。应优先优化哪个指标？
   A. 上下文精确率（Context Precision）
   B. 答案忠实度（Faithfulness）
   **C**. 上下文召回率（Context Recall）
   D. 答案相关性（Relevance）
4. 以下哪种文本切片策略最适合处理包含复杂逻辑关系的技术文档（如 API 调用说明）？
   A. 固定长度切片（如每 500 字切分为一段）
   B. 按句子边界切片（确保每个切片为完整句子）
   **C**. 按语义段落切片（根据文档结构和主题划分）
   D. 随机切片（增加检索的多样性）
5. 在阿里云百炼平台中，使用向量数据库存储文档嵌入向量时，优化检索效率的关键参数是：
   A. 向量维度（Dimension）  影响精度
   B. 相似度阈值（Similarity Threshold） 影响精度
   C. 索引类型（Index Type） 效率
   D. 文档格式（如 PDF/Word） 无关
6. 某 RAG 系统采用 "检索增强 + 提示词约束" 的方式优化答案生成，要求模型 "仅基于检索到的上下文回答，不添加外部知识"，这主要是为了提升：
   A. 检索速度
   **B**. 答案忠实度（Faithfulness）
   C. 上下文相关性（Context Relevance）
   D. 回答的丰富度
7. 对于包含表格、图表的结构化文档，优化 RAG 检索效果的最佳做法是：
   A. 直接将表格转换为纯文本后进行切片
   **B.** 采用结构化解析工具提取表格内容并保留字段关系
   C. 忽略表格内容，仅处理文本段落
   D. 增加表格内容的权重，优先检索
8. 某企业 RAG 系统在高并发场景下响应延迟过高，最有效的优化方案是：
   A. 增加文本切片的数量
   **B**. 优化向量数据库的索引和查询参数
   C. 更换更大规模的基础模型     会增加延迟
   D. 减少检索到的上下文长度

### 二、多选题（6 题）

1. 优化 RAG 系统检索阶段效果的常用方法包括：（多选）
   **A**. 采用混合检索策略（如关键词检索 + 向量检索）
   **B**. 对文档进行预处理，提取关键信息并生成摘要
   **C**. 调整向量嵌入模型，使用领域专用模型
   D. 增加提示词的复杂度
2. 以下属于提升 RAG 系统上下文质量的策略有：（多选）
   **A**. 对检索到的段落进行重排序，优先使用相关性高的内容
   **B**. 过滤冗余信息，仅保留与问题直接相关的段落
   **C**. 合并语义相关的多个短段落，确保信息完整性
   D. 增加每个问题的检索结果数量（如从 5 条增至 10 条）
3. 在 RAG 系统中，影响向量检索效果的因素包括：（多选）
   **A**. 嵌入模型的选择（如通用模型 vs 领域模型）
   **B**. 文本切片的粒度和策略
   **C.** 向量数据库的相似度计算方法
   D. 基础模型的参数规模
4. 针对 RAG 系统中 "幻觉回答"（生成未在知识库中提及的内容）的问题，可采取的优化措施有：（多选）
   **A**. 在提示词中明确约束 "仅基于提供的上下文回答"
   **B**. 提升上下文召回率，确保关键信息被检索到
   **C**. 使用 RAGAS 工具监测答案忠实度（Faithfulness）并持续优化
   D. 增加生成答案的长度，降低遗漏概率
5. 以下关于 RAG 系统中文本切片策略的说法，正确的有：（多选）
   **A**. 过细的切片可能导致语义割裂，影响回答连贯性
   **B**. 过粗的切片可能包含过多无关信息，降低检索精确率
   C. 对于长文档，应采用固定长度的切片策略以保证一致性
   **D**. 可根据文档类型动态调整切片策略（如技术文档更细，散文更粗）
6. 部署 RAG 系统到生产环境时，需考虑的性能优化方向包括：（多选）
   **A**. 对高频查询的结果进行缓存
   **B**. 优化向量数据库的查询 latency
   **C**. 采用增量更新机制，减少全量索引重建次数
   D. 增加基础模型的推理批次大小

### 三、判断题（8 题）

1. RAG 系统的上下文召回率越高，说明检索到的无关段落越少。（f ）
2. 向量检索的核心是通过计算问题与文档的语义相似度来返回相关内容。（t ）
3. 文本切片粒度越细，RAG 系统的检索精确率一定越高。（ f）
4. 混合检索（关键词 + 向量）通常比单一检索策略更能应对多样化的查询需求。（t ）
5. 提升 RAG 系统性能时，应优先优化生成阶段，再考虑检索阶段。（f ）
6. 答案忠实度（Faithfulness）低的主要原因是检索到的上下文信息不足。（ f）
7. 对知识库进行定期更新和去重，有助于提升 RAG 系统的长期效果。（t ）
8. 在 RAG 系统中，检索到的上下文越多，生成的答案质量一定越高。（ f）

### 四、场景分析题（3 题）

1. 某医疗健康 RAG 系统存在以下问题：

   - 回答用户关于 "糖尿病用药禁忌" 的问题时，常遗漏关键药物相互作用信息（知识库中存在该内容）；
   - 生成的答案中偶尔包含错误的饮食建议（未在知识库中提及）。
     - **可能原因**：
       检索阶段：上下文召回率低（关键信息未被检索到）；文本切片过细导致关键信息被割裂。
       生成阶段：提示词未明确约束 "仅基于上下文回答"；模型过度依赖内部知识生成内容。
     - **检索阶段优化**：
       ① 调整文本切片策略，采用语义段落切片，确保药物相互作用信息的完整性；
       ② 优化检索参数，提升上下文召回率（如降低相似度阈值，增加召回数量）。
     - **生成阶段优化**：
       ① 增强提示词约束，如 "仅使用提供的医疗知识库内容回答，不添加任何外部建议"；
       ② 使用 RAGAS 工具监测答案忠实度，对低忠实度样本进行针对性优化。

   请分析可能的原因，并从检索阶段和生成阶段分别提出优化措施。

2. 某金融行业 RAG 系统处理结构化文档（如贷款合同条款、利率表）时，检索效果不佳：

   - 无法准确检索到表格中的具体条款（如 "贷款利率调整条件"）；
   - 对包含专业术语的问题（如 "LPR 浮动机制"）响应缓慢。

   请设计优化方案，提升该系统对结构化文档的处理能力和检索效率。

- ① **采用结构化文档解析工具**（如阿里云百炼的文档理解能力），提取表格内容并保留字段关系，**生成结构化向量**；
- ② 对**专业术语建立同义词表**，在检索前**对用户问题进行术语扩展**（如将 "LPR" 扩展为 "贷款市场报价利率"）
- ③ **采用混合检索策略**：对**表格内容**使用**关键词精确匹配**，对**文本段落**使用**向量检索**
- ④ **优化向量数据库索引**，针对金融领域文档特点调整索引参数（如增加 HNSW 索引的 efConstruction 值）；
- ⑤ 对高频查询的结构化数据（如利率表）进行**缓存**，减少实时检索压力。

1. 某电商平台 RAG 系统在促销活动期间面临高并发查询（如 "优惠券使用规则"" 满减活动时间 "），出现响应延迟超过 3 秒的问题，影响用户体验。请从系统架构和参数优化两个角度，提出至少 4 项具体优化措施。
      - **系统架构优化**：
        ① 对高频查询的结构化数据（如满减活动时间）进行**缓存**，减少实时检索压力。
        ② 采用负载均衡，将查询请求分配到多个 RAG 实例，提高并发处理能力；
        ③ 对知识库进行分片存储，按业务场景（如优惠券、满减）划分索引，减少单次检索范围。
        - **参数优化**：
          ① 优化向量数据库查询参数（如减少检索返回的段落数量，从 10 条降至 5 条）；
          ② 调整文本切片粒度，对促销规则等短文本采用较粗切片，减少检索计算量；
          ③ 降低生成阶段的`max_tokens`参数，限制回答长度，提升响应速度。



# 2.6.用插件扩展答疑机器人的能力边界

- 掌握Agent系统的核心理念

- 熟悉Multi-Agent系统的设计与实现

- 掌握核心工具与框架以应对复杂任务

  

  智能体应用的核心思想——通过任务分解和自动化执行

  ## 2.如何构建 Agent

  ### 2.1明确目标

  清晰地定义任务的核心目标

  ### 2.2定义工具函数

  从零来构建一个Agent需要处理复杂的底层实现，这往往需要大量的时间和精力.

  Assistant API 是一种简化智能体应用创建过程的接口。它提供了丰富的功能，包括支持多种基础模型、灵活的工具调用、对话管理和高度可扩展性。

  ### 2.3将工具函数与大模型集成进Agent中

  智能体的工作原理可以从以下几个核心模块进行理解：

  - 工具模块

    工具模块负责定义和管理智能体能够使用的各种工具。包括工具的描述、参数以及功能特性。这一模块确保智能体能够理解并有效使用这些工具来完成任务。

  - 记忆模块

    记忆模块可以分为长期记忆和短期记忆。

    长期记忆用于存储持久的信息和经验，帮助智能体进行模式学习、知识积累和个性化服务。

    短期记忆则用于临时存储当前任务相关的信息，以支持智能体在任务执行过程中实时调整决策。

  - 计划能力

    计划能力模块负责任务的规划。通过智能体的决策能力，这部分帮助智能体分解复杂任务，制定具体的行动步骤和策略，确保任务顺利完成。

  - 行动能力

    行动能力与工具模块紧密配合，确保智能体能够选择合适的工具，并通过容器执行相应的操作。行动能力是智能体实现任务的核心，确保其能够根据既定计划和决策，有效地实施各项任务。

  通过这些模块的协作，智能体能够处理复杂任务，提升任务执行的效率和精准度，突破传统方法的局限。

### 3. 使用大模型进行意图识别

​	这个**识别用户真实目的**的过程，在行业内有一个专门的术语，叫做 **意图识别（Intent Recognition）**。

你可以把意图识别想象成一个**智能客服前台**。

这正是 2.1 章提到的 **上下文工程（Context Engineering）** 的一个更深层次的应用。回顾一下：

- **通过 RAG 添加知识**，是你为大模型**填充上下文**，解决它“不知道”的问题。
- **通过意图识别**，你开始**控制上下文**，决定在何时、何种情况下、填充什么样的上下文（甚至不填充）。

### 3.1 意图识别

接下来，将构建提示词使大模型对问题分类。由于经过意图识别后要取得格式化的内容，才能进行文档审查或者使用RAG应用，所以为了能将用户的问题准确分类，将考虑以下提示词技巧：

- 明确输出格式：指定输出格式，使分类结果规范且易于解析。
- Few-shot 示例：提供示例，帮助大模型理解每个类别的特征和分类规则。

###  3.2 将意图识别应用到答疑机器人中

对用户的问题进行意图识别后，你就可以让答疑机器人先识别问题的类型，再使用不同的提示词和工作流程来回答问题。

通过引入意图识别这一步骤，我们的答疑机器人变得更加智能。这正是**上下文工程**中“控制流”设计的体现。它不再是一个简单的“提问-检索-回答”的线性流程，而是根据任务类型动态地调整其行为。这样做的好处是显而易见的：

- 节省资源：对于检查文档错误的问题，大模型其实可以直接回复，并不需要检索参考资料，之前的实现存在资源浪费。
- 避免误解：之前的实现每次会检索参考资料，这些被召回的相关文本段可能会干扰大模型理解问题，导致答非所问。

我们刚刚构建的意图识别模块，本质上是一个简单的“路由器”，它决定了用户的请求应该走哪条处理路径。这种路由和规划的思想，是更高级智能体系统的核心。现在你已经了解了如何应对不同类型的任务，让我们回到最初的工具型智能体，看看如何处理需要**组合使用多个工具**的更复杂的任务。这将引导我们进入多智能体（Multi-Agent）系统的世界。



## 4.多智能体Multi-Agent

